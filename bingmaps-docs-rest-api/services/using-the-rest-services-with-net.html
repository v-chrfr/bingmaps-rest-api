<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Using the REST Services with .NET | Microsoft Docs </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Using the REST Services with .NET | Microsoft Docs ">
    <meta name="generator" content="docfx 2.36.1.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="using-the-rest-services-with-net">Using the REST Services with .NET</h1>

<div class="IMPORTANT">
<h5>Important</h5>
<p>Update: Since writing this documentation the Bing Maps team has released an open source portable class library which makes it easy to access the Bing Maps REST services from any .NET application. You can find this library on GitHub              <a href="https://github.com/Microsoft/BingMapsRESTToolkit/">here</a>.</p>
</div>
<p>This article will describe how to interact with the Bing Maps REST Services APIs using .NET. This approach can be used with technologies such as Windows Store apps and Windows Presentation Foundation (WPF).</p>
<p>The Bing Maps REST Services are a set of RESTful web services that access collection of resources by using a URL and the HTTP GET and POST methods The size of REST responses tend to be significantly smaller than SOAP-based service responses, and reduce the amount of time it takes a client application to download the response data. This increase in efficiency becomes especially important when developing mobile applications.</p>
<p>Each Bing Maps REST Services request is made using a URI and additional query parameters that specify the information to return. Some REST Services APIs support HTTP POST requests that you can use when the query parameter data increases the URL length beyond browser limits. You can specify XML or JSON format for the response. A JSON response is typically 25%-40% smaller than an XML response, and will take less time for the client to download. This topic focuses on JSON responses only.</p>
<h2 id="making-use-of-sessions">Making use of sessions</h2>
<p>All Bing Maps REST Services require a Bing Maps Key. If you are using the Bing Maps REST Services with one of the Bing Maps controls, such as AJAX, WPF, Windows Store app SDK, you can use a Bing Maps key as a session key. A session key can be used for all requests to the Bing Maps REST Services. The benefit of using a session key is that you are billed for one transaction per session and all calls to the REST services within that session are non-billable. For more information about billed transactions, see <a href="http://msdn.microsoft.com/en-us/library/ff859477.aspx">Viewing Bing Maps Usage Reports</a>.</p>
<p>The following examples show how to create a session key from an instance of Bing Maps control using .NET.</p>
<pre><code class="lang-csharp">Map.CredentialsProvider.GetCredentials((c) =&gt;  
{  
    string sessionKey = c.ApplicationId;  
  
    //Generate a request URL for the Bing Maps REST services.  
    //Use the session key in the request as the Bing Maps key  
});  
</code></pre>
<pre><code class="lang-vb">Map.CredentialsProvider.GetCredentials(  
        Function(c)  
            Dim sessionKey As String = c.ApplicationId  
            'Generate a request URL for the Bing Maps REST services.  
            'Use the session key in the request as the Bing Maps key  
            Return 0  
        End Function)  
</code></pre>
<h2 id="making-the-request">Making the request</h2>
<div class="IMPORTANT">
<h5>Important</h5>
<p>The Response class is part of the data contracts for the Bing Maps REST services. The data contracts for the Bing Maps REST Services are quite large and have been included at the end of this topic. You must copy these data contract classes into your application.</p>
</div>
<p>To access the Bing Maps REST Services, you create a URL request and then submit the request using HTTP <strong>GET</strong> or <strong>POST</strong> protocol . When the response data is returned, you must serialize the data against a set of data contracts. The data contracts for the Bing Maps REST Services are quite large and have been included at the end of this topic. As the Bing Maps REST Services adds new functionality, these data contracts must be updated. A benefit of working with JSON serialization rather than XML serialization is that changes in the schema rarely cause issues for existing applications. For instance, if a new property is added to the Bing Maps REST Services, an application that uses the old data contracts can still process a response without errors; however, the new property will not be available. To get the new property, you must update the data contracts.</p>
<p>In order to make use of JSON serialization in .NET, use the DataContractJsonSerializer by referencing the following libraries in your project:</p>
<ul>
<li><p>System.Runtime.Serialization</p>
</li>
<li><p>System.ServiceModel.Web</p>
</li>
</ul>
<p>When you specify parameter data for a Bing Maps REST service request, it is a good practice to encode the parameter values. This becomes especially important when working with special characters. In the following code samples, we use the Uri class that encodes these parameters automatically.</p>
<h3 id="http-get-requests">HTTP GET Requests</h3>
<p>The following example is a generic method that can be used to make GET requests with Bing Maps REST Services.</p>
<pre><code class="lang-csharp">private void GetResponse(Uri uri, Action&lt;Response&gt; callback)  
{  
    WebClient wc = new WebClient();  
    wc.OpenReadCompleted += (o, a) =&gt;  
    {  
        if (callback != null)  
        {  
            DataContractJsonSerializer ser = new DataContractJsonSerializer(typeof(Response));  
            callback(ser.ReadObject(a.Result) as Response);  
        }  
    };  
    wc.OpenReadAsync(uri);  
}  
</code></pre>
<pre><code class="lang-vb">Private Sub GetResponse(uri As Uri, callback As Action(Of Response))  
    Dim wc As New WebClient()  
    AddHandler wc.OpenReadCompleted,  
        Function(o, a)  
            If callback IsNot Nothing Then  
               Dim ser As New DataContractJsonSerializer(GetType(Response))  
               callback(TryCast(ser.ReadObject(a.Result), Response))  
            End If  
           Return 0  
       End Function  
    wc.OpenReadAsync(uri)  
End Sub  
</code></pre>
<h3 id="http-post-requests">HTTP POST Requests</h3>
<p>The following example is a generic method that can be used to make HTTP POST requests with Bing Maps REST Services for APIs that support HTTP POST protocol.</p>
<pre><code class="lang-csharp">private void GetPOSTResponse(Uri uri, string data, Action&lt;Response&gt; callback)  
{  
    HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(uri);  
  
    request.Method = &quot;POST&quot;;  
    request.ContentType = &quot;text/plain;charset=utf-8&quot;;  
  
    System.Text.UTF8Encoding encoding = new System.Text.UTF8Encoding();  
    byte[] bytes = encoding.GetBytes(data);  
  
    request.ContentLength = bytes.Length;  
  
    using (Stream requestStream = request.GetRequestStream())  
    {  
        // Send the data.  
        requestStream.Write(bytes, 0, bytes.Length);  
    }  
  
    request.BeginGetResponse((x) =&gt;  
    {  
        using (HttpWebResponse response = (HttpWebResponse)request.EndGetResponse(x))  
        {  
            if (callback != null)  
            {  
                DataContractJsonSerializer ser = new DataContractJsonSerializer(typeof(Response));  
                callback(ser.ReadObject(response.GetResponseStream()) as Response);  
            }  
        }  
    }, null);  
}  
</code></pre>
<pre><code class="lang-vb">Private Sub GetPOSTResponse(uri As Uri, data As String, callback As Action(Of Response))  
    Dim request As HttpWebRequest = DirectCast(HttpWebRequest.Create(uri), HttpWebRequest)  
  
    request.Method = &quot;POST&quot;  
    request.ContentType = &quot;text/plain;charset=utf-8&quot;  
  
    Dim encoding As New System.Text.UTF8Encoding()  
    Dim bytes As Byte() = encoding.GetBytes(data)  
  
    request.ContentLength = bytes.Length  
  
    Using requestStream As Stream = request.GetRequestStream()  
        ' Send the data.  
        requestStream.Write(bytes, 0, bytes.Length)  
    End Using  
  
    request.BeginGetResponse(  
        Function(x)  
            Using response As HttpWebResponse = DirectCast(request.EndGetResponse(x), HttpWebResponse)  
                If callback IsNot Nothing Then  
                    Dim ser As New DataContractJsonSerializer(GetType(Response))  
                    callback(TryCast(ser.ReadObject(response.GetResponseStream()), Response))  
                End If  
            End Using  
            Return 0  
        End Function, Nothing)  
End Sub  
</code></pre>
<h3 id="implementing-a-request">Implementing a request</h3>
<p>The following is an example of how to use the above generic methods to make an HTTP GET request to the Bing Maps REST Services. This example geocodes the address “1 Microsoft Way, Redmond, WA”.</p>
<pre><code class="lang-csharp">string key = &quot;YOUR_BING_MAPS_KEY or SESSION_KEY&quot;;  
string query = &quot;1 Microsoft Way, Redmond, WA&quot;;  
  
Uri geocodeRequest = new Uri(string.Format(&quot;http://dev.virtualearth.net/REST/v1/Locations?q={0}&amp;key={1}&quot;, query, key));  
  
GetResponse(geocodeRequest, (x) =&gt;  
{  
    Console.WriteLine(x.ResourceSets[0].Resources.Length + &quot; result(s) found.&quot;);  
    Console.ReadLine();  
});  
</code></pre>
<pre><code class="lang-vb">Dim key As String = &quot;YOUR_BING_MAPS_KEY or SESSION_KEY&quot;  
Dim query As String = &quot;1 Microsoft Way, Redmond, WA&quot;  
  
Dim geocodeRequest As New Uri(String.Format(&quot;http://dev.virtualearth.net/REST/v1/Locations?q={0}&amp;key={1}&quot;, query, key))  
  
GetResponse(geocodeRequest, Function(x)  
   Console.WriteLine(x.ResourceSets(0).Resources.Length + &quot; result(s) found.&quot;)  
   Console.ReadLine()  
   Return 0  
End Function)  
</code></pre>
<h3 id="data-contracts">Data Contracts</h3>
<p>The data contracts for the Bing Maps REST Services are large but straight forward. All classes need to have a DataContract attribute, and all public properties that are to be serialized need to have a DataMember attribute, and both a getter and a setter in C#. See <a href="../rest-services/json-data-contracts.md">JSON Data Contracts</a> for the latest set of contracts.</p>
<h2 id="see-also">See Also</h2>
<p><a href="http://blogs.bing.com/maps/2013/02/14/bing-maps-rest-service-tips-tricks/">Bing Maps REST Service Tips &amp; Tricks</a><br>
<a href="http://blogs.bing.com/maps/2013/06/20/geocoding-with-the-search-charm/">Geocoding With the Search Charm (Blog)</a><br>
<a href="https://code.msdn.microsoft.com/Geocoding-with-the-Search-b1dcbf8a">Geocoding with the Search Charm (Code)</a><br>
<a href="http://blogs.msdn.com/b/rbrundritt/archive/2013/11/08/how-to-share-maps-using-the-share-charm-in-windows-store-apps.aspx">How to Share Maps Using the Share Charm in Windows Store Apps</a></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/v-chrfr/bingmaps-rest-api/blob/master/docs-ref-index/using-the-rest-services-with-net.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
